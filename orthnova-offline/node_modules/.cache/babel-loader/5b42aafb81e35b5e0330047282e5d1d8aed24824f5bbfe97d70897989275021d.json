{"ast":null,"code":"import _objectSpread from\"C:/Users/Me/Desktop/orthnova-app/orthnova-offline/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useMemo,useState}from'react';import{getDoctorById,getPatientById,listPrescriptions}from'../../api';import{formatDateTime}from'../../utils/format';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const PrescriptionsList=()=>{const[rows,setRows]=useState([]);const[loading,setLoading]=useState(false);const[error,setError]=useState(null);const[searchText,setSearchText]=useState('');const[searchDate,setSearchDate]=useState('');useEffect(()=>{(async()=>{setLoading(true);setError(null);try{const list=await listPrescriptions();const enriched=await Promise.all(list.map(async r=>{const[p,d]=await Promise.all([getPatientById(r.patient_id),getDoctorById(r.doctor_id)]);return _objectSpread(_objectSpread({},r),{},{patientName:p===null||p===void 0?void 0:p.name,doctorName:d===null||d===void 0?void 0:d.name});}));setRows(enriched);}catch(e){setError(e.message);}finally{setLoading(false);}})();},[]);const filtered=useMemo(()=>{const txt=searchText.trim().toLowerCase();const date=searchDate;return rows.filter(r=>{const matchesText=!txt||[r.patientName,r.doctorName].filter(Boolean).some(v=>String(v).toLowerCase().includes(txt));const matchesDate=!date||new Date(r.created_at).toISOString().slice(0,10)===date;return matchesText&&matchesDate;});},[rows,searchText,searchDate]);return/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"card p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-3 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium\",children:\"Search (Patient/Doctor)\"}),/*#__PURE__*/_jsx(\"input\",{className:\"mt-1 w-full\",value:searchText,onChange:e=>setSearchText(e.target.value),placeholder:\"Type to filter\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium\",children:\"Date\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",className:\"mt-1 w-full\",value:searchDate,onChange:e=>setSearchDate(e.target.value)})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex items-end\",children:/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-secondary\",onClick:()=>{setSearchText('');setSearchDate('');},disabled:loading,children:\"Clear\"})})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"card p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-4\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-semibold\",children:\"Prescription History\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-secondary\",onClick:()=>window.location.reload(),disabled:loading,children:\"Refresh\"})]}),error&&/*#__PURE__*/_jsx(\"p\",{className:\"text-red-600 text-sm mb-2\",children:error}),/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"min-w-full text-sm\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{className:\"text-left text-gray-500\",children:[/*#__PURE__*/_jsx(\"th\",{className:\"py-2 pr-4\",children:\"Date/Time\"}),/*#__PURE__*/_jsx(\"th\",{className:\"py-2 pr-4\",children:\"Patient\"}),/*#__PURE__*/_jsx(\"th\",{className:\"py-2 pr-4\",children:\"Doctor\"}),/*#__PURE__*/_jsx(\"th\",{className:\"py-2 pr-4\",children:\"Actions\"})]})}),/*#__PURE__*/_jsxs(\"tbody\",{children:[filtered.map(r=>/*#__PURE__*/_jsxs(\"tr\",{className:\"border-t border-gray-100\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"py-2 pr-4\",children:formatDateTime(r.created_at)}),/*#__PURE__*/_jsx(\"td\",{className:\"py-2 pr-4\",children:r.patientName||r.patient_id}),/*#__PURE__*/_jsx(\"td\",{className:\"py-2 pr-4\",children:r.doctorName||r.doctor_id}),/*#__PURE__*/_jsx(\"td\",{className:\"py-2 pr-4\",children:/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-secondary px-3 py-1\",onClick:()=>{const win=window.open(\"\".concat(window.location.origin,\"/print/prescription/\").concat(r.id),'_blank');if(win)win.focus();},children:\"Print\"})})]},r.id)),filtered.length===0&&/*#__PURE__*/_jsx(\"tr\",{children:/*#__PURE__*/_jsx(\"td\",{className:\"py-4 text-gray-500\",colSpan:4,children:loading?'Loading...':'No prescriptions found.'})})]})]})})]})]});};export default PrescriptionsList;","map":{"version":3,"names":["React","useEffect","useMemo","useState","getDoctorById","getPatientById","listPrescriptions","formatDateTime","jsx","_jsx","jsxs","_jsxs","PrescriptionsList","rows","setRows","loading","setLoading","error","setError","searchText","setSearchText","searchDate","setSearchDate","list","enriched","Promise","all","map","r","p","d","patient_id","doctor_id","_objectSpread","patientName","name","doctorName","e","message","filtered","txt","trim","toLowerCase","date","filter","matchesText","Boolean","some","v","String","includes","matchesDate","Date","created_at","toISOString","slice","className","children","value","onChange","target","placeholder","type","onClick","disabled","window","location","reload","win","open","concat","origin","id","focus","length","colSpan"],"sources":["C:/Users/Me/Desktop/orthnova-app/orthnova-offline/src/components/prescriptions/PrescriptionsList.tsx"],"sourcesContent":["import React, { useEffect, useMemo, useState } from 'react';\r\nimport { getDoctorById, getPatientById, listPrescriptions } from '../../api';\r\nimport { PrescriptionRow } from '../../types';\r\nimport { formatDateTime } from '../../utils/format';\r\n\r\ninterface Enriched extends PrescriptionRow { patientName?: string; doctorName?: string; }\r\n\r\nconst PrescriptionsList: React.FC = () => {\r\n  const [rows, setRows] = useState<Enriched[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const [searchText, setSearchText] = useState('');\r\n  const [searchDate, setSearchDate] = useState('');\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      setLoading(true); setError(null);\r\n      try {\r\n        const list = await listPrescriptions();\r\n        const enriched: Enriched[] = await Promise.all(list.map(async r => {\r\n          const [p, d] = await Promise.all([getPatientById(r.patient_id), getDoctorById(r.doctor_id)]);\r\n          return { ...r, patientName: p?.name, doctorName: d?.name };\r\n        }));\r\n        setRows(enriched);\r\n      } catch (e: any) { setError(e.message); }\r\n      finally { setLoading(false); }\r\n    })();\r\n  }, []);\r\n\r\n  const filtered = useMemo(() => {\r\n    const txt = searchText.trim().toLowerCase();\r\n    const date = searchDate;\r\n    return rows.filter(r => {\r\n      const matchesText = !txt || [r.patientName, r.doctorName]\r\n        .filter(Boolean)\r\n        .some(v => String(v).toLowerCase().includes(txt));\r\n      const matchesDate = !date || (new Date(r.created_at).toISOString().slice(0,10) === date);\r\n      return matchesText && matchesDate;\r\n    });\r\n  }, [rows, searchText, searchDate]);\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      <div className=\"card p-4\">\r\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n          <div>\r\n            <label className=\"block text-sm font-medium\">Search (Patient/Doctor)</label>\r\n            <input className=\"mt-1 w-full\" value={searchText} onChange={e => setSearchText(e.target.value)} placeholder=\"Type to filter\" />\r\n          </div>\r\n          <div>\r\n            <label className=\"block text-sm font-medium\">Date</label>\r\n            <input type=\"date\" className=\"mt-1 w-full\" value={searchDate} onChange={e => setSearchDate(e.target.value)} />\r\n          </div>\r\n          <div className=\"flex items-end\">\r\n            <button className=\"btn btn-secondary\" onClick={() => { setSearchText(''); setSearchDate(''); }} disabled={loading}>Clear</button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"card p-6\">\r\n        <div className=\"flex items-center justify-between mb-4\">\r\n          <h2 className=\"text-xl font-semibold\">Prescription History</h2>\r\n          <button className=\"btn btn-secondary\" onClick={() => window.location.reload()} disabled={loading}>Refresh</button>\r\n        </div>\r\n        {error && <p className=\"text-red-600 text-sm mb-2\">{error}</p>}\r\n        <div className=\"overflow-x-auto\">\r\n          <table className=\"min-w-full text-sm\">\r\n            <thead>\r\n              <tr className=\"text-left text-gray-500\">\r\n                <th className=\"py-2 pr-4\">Date/Time</th>\r\n                <th className=\"py-2 pr-4\">Patient</th>\r\n                <th className=\"py-2 pr-4\">Doctor</th>\r\n                <th className=\"py-2 pr-4\">Actions</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {filtered.map(r => (\r\n                <tr key={r.id} className=\"border-t border-gray-100\">\r\n                  <td className=\"py-2 pr-4\">{formatDateTime(r.created_at)}</td>\r\n                  <td className=\"py-2 pr-4\">{r.patientName || r.patient_id}</td>\r\n                  <td className=\"py-2 pr-4\">{r.doctorName || r.doctor_id}</td>\r\n                  <td className=\"py-2 pr-4\">\r\n                    <button className=\"btn btn-secondary px-3 py-1\" onClick={() => {\r\n                      const win = window.open(`${window.location.origin}/print/prescription/${r.id}`, '_blank'); if (win) win.focus();\r\n                    }}>Print</button>\r\n                  </td>\r\n                </tr>\r\n              ))}\r\n              {filtered.length === 0 && (\r\n                <tr><td className=\"py-4 text-gray-500\" colSpan={4}>{loading ? 'Loading...' : 'No prescriptions found.'}</td></tr>\r\n              )}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PrescriptionsList;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}