{"ast":null,"code":"import React,{createContext,useCallback,useContext,useEffect,useMemo,useState}from'react';// Note: We're not importing supabase anymore since we're using localStorage directly\nimport{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext(undefined);const LOCAL_STORAGE_KEY='orthonova_session_user_v1';const USERS_STORAGE_KEY='orthnova_data';export const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[loading,setLoading]=useState(true);useEffect(()=>{const raw=localStorage.getItem(LOCAL_STORAGE_KEY);if(raw){try{const parsed=JSON.parse(raw);setUser(parsed);}catch(_unused){localStorage.removeItem(LOCAL_STORAGE_KEY);}}setLoading(false);},[]);const login=useCallback(async(userId,password)=>{setLoading(true);try{// Get users from localStorage\nconst data=localStorage.getItem(USERS_STORAGE_KEY);const appData=data?JSON.parse(data):{users:[]};// Find user in the stored data\nconst userData=appData.users.find(u=>u.user_id===userId);if(!userData){return{ok:false,error:'Invalid credentials.'};}if(userData.password!==password){return{ok:false,error:'Invalid credentials.'};}const sessionUser={userId:userData.user_id,role:userData.role};setUser(sessionUser);localStorage.setItem(LOCAL_STORAGE_KEY,JSON.stringify(sessionUser));return{ok:true};}catch(error){return{ok:false,error:'Login failed. Please try again.'};}finally{setLoading(false);}},[]);const logout=useCallback(()=>{setUser(null);localStorage.removeItem(LOCAL_STORAGE_KEY);},[]);const value=useMemo(()=>({user,loading,login,logout}),[user,loading,login,logout]);return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:children});};export function useAuth(){const ctx=useContext(AuthContext);if(!ctx)throw new Error('useAuth must be used within AuthProvider');return ctx;}","map":{"version":3,"names":["React","createContext","useCallback","useContext","useEffect","useMemo","useState","jsx","_jsx","AuthContext","undefined","LOCAL_STORAGE_KEY","USERS_STORAGE_KEY","AuthProvider","_ref","children","user","setUser","loading","setLoading","raw","localStorage","getItem","parsed","JSON","parse","_unused","removeItem","login","userId","password","data","appData","users","userData","find","u","user_id","ok","error","sessionUser","role","setItem","stringify","logout","value","Provider","useAuth","ctx","Error"],"sources":["C:/Users/Me/Desktop/orthnova-app/orthnova-offline/src/context/AuthContext.tsx"],"sourcesContent":["import React, { createContext, useCallback, useContext, useEffect, useMemo, useState } from 'react';\r\n// Note: We're not importing supabase anymore since we're using localStorage directly\r\nimport { SessionUser, UserRole } from '../types';\r\n\r\ninterface AuthContextValue {\r\n  user: SessionUser | null;\r\n  loading: boolean;\r\n  login: (userId: string, password: string) => Promise<{ ok: true } | { ok: false; error: string }>;\r\n  logout: () => void;\r\n}\r\n\r\nconst AuthContext = createContext<AuthContextValue | undefined>(undefined);\r\n\r\nconst LOCAL_STORAGE_KEY = 'orthonova_session_user_v1';\r\nconst USERS_STORAGE_KEY = 'orthnova_data';\r\n\r\nexport const AuthProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\r\n  const [user, setUser] = useState<SessionUser | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    const raw = localStorage.getItem(LOCAL_STORAGE_KEY);\r\n    if (raw) {\r\n      try {\r\n        const parsed: SessionUser = JSON.parse(raw);\r\n        setUser(parsed);\r\n      } catch {\r\n        localStorage.removeItem(LOCAL_STORAGE_KEY);\r\n      }\r\n    }\r\n    setLoading(false);\r\n  }, []);\r\n\r\n  const login = useCallback(async (userId: string, password: string) => {\r\n    setLoading(true);\r\n    try {\r\n      // Get users from localStorage\r\n      const data = localStorage.getItem(USERS_STORAGE_KEY);\r\n      const appData = data ? JSON.parse(data) : { users: [] };\r\n      \r\n      // Find user in the stored data\r\n      const userData = appData.users.find((u: any) => u.user_id === userId);\r\n      \r\n      if (!userData) {\r\n        return { ok: false as const, error: 'Invalid credentials.' };\r\n      }\r\n      \r\n      if (userData.password !== password) {\r\n        return { ok: false as const, error: 'Invalid credentials.' };\r\n      }\r\n      \r\n      const sessionUser: SessionUser = { userId: userData.user_id, role: userData.role as UserRole };\r\n      setUser(sessionUser);\r\n      localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(sessionUser));\r\n      return { ok: true as const };\r\n    } catch (error) {\r\n      return { ok: false as const, error: 'Login failed. Please try again.' };\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  const logout = useCallback(() => {\r\n    setUser(null);\r\n    localStorage.removeItem(LOCAL_STORAGE_KEY);\r\n  }, []);\r\n\r\n  const value = useMemo(() => ({ user, loading, login, logout }), [user, loading, login, logout]);\r\n\r\n  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;\r\n};\r\n\r\nexport function useAuth(): AuthContextValue {\r\n  const ctx = useContext(AuthContext);\r\n  if (!ctx) throw new Error('useAuth must be used within AuthProvider');\r\n  return ctx;\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}