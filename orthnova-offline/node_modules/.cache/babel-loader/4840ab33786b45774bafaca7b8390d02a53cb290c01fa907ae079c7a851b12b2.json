{"ast":null,"code":"import _objectSpread from\"C:/Users/Me/Desktop/orthnova-app/orthnova-offline/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useMemo,useState}from'react';import{createPatient,createAppointment,createBill,recordPayment,listDoctors,listServices,searchPatientsByContact}from'../../api';import{formatCurrency,generateBillNumber}from'../../utils/format';import{generatePatientId}from'../../utils/idGenerators';import Modal from'../common/Modal';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const MODES=['Cash','UPI','Card'];const BillingSystem=()=>{const[doctors,setDoctors]=useState([]);const[services,setServices]=useState([]);const[patientSearch,setPatientSearch]=useState('');const[patientId,setPatientId]=useState('');const[selectedPatient,setSelectedPatient]=useState(null);const[patientMatches,setPatientMatches]=useState([]);const[patientModalOpen,setPatientModalOpen]=useState(false);// Guest/non-registered patient support\nconst[isGuest,setIsGuest]=useState(false);const[guestName,setGuestName]=useState('');const[guestContact,setGuestContact]=useState('');const[doctorQuery,setDoctorQuery]=useState('');const[doctorId,setDoctorId]=useState('');const[appointmentId,setAppointmentId]=useState(null);const[items,setItems]=useState([]);const[serviceSearch,setServiceSearch]=useState('');const[discountPercent,setDiscountPercent]=useState(0);const[mode,setMode]=useState('Cash');const[txnRef,setTxnRef]=useState('');const[status,setStatus]=useState('paid');const[submitting,setSubmitting]=useState(false);const[message,setMessage]=useState(null);const refreshDoctors=async()=>{try{const data=await listDoctors();setDoctors(data);}catch(e){console.error('Error refreshing doctors:',e);}};useEffect(()=>{(async()=>{const[d,s]=await Promise.all([listDoctors(),listServices()]);setDoctors(d);setServices(s);})();},[]);const doctor=useMemo(()=>doctors.find(d=>d.id===doctorId)||null,[doctors,doctorId]);const opdFee=useMemo(()=>Number((doctor===null||doctor===void 0?void 0:doctor.opd_fees)||0),[doctor]);const servicesTotal=useMemo(()=>items.reduce((sum,it)=>sum+Number(it.service.price)*it.quantity,0),[items]);const total=useMemo(()=>servicesTotal+opdFee,[servicesTotal,opdFee]);const discountAmount=useMemo(()=>total*Number(discountPercent||0)/100,[total,discountPercent]);const net=useMemo(()=>Math.max(0,total-discountAmount),[total,discountAmount]);const addItem=service=>{setItems(prev=>{const existing=prev.find(it=>it.service.id===service.id);if(existing)return prev.map(it=>it.service.id===service.id?_objectSpread(_objectSpread({},it),{},{quantity:it.quantity+1}):it);return[...prev,{service,quantity:1}];});};const updateQty=(serviceId,qty)=>{if(qty<=0){setItems(prev=>prev.filter(it=>it.service.id!==serviceId));}else{setItems(prev=>prev.map(it=>it.service.id===serviceId?_objectSpread(_objectSpread({},it),{},{quantity:qty}):it));}};const onSearchPatient=async()=>{setMessage(null);if(isGuest)return;// skip search in guest mode\nconst rows=await searchPatientsByContact(patientSearch);if(rows.length===1){setPatientId(rows[0].id);setSelectedPatient(rows[0]);setPatientMatches([]);}else if(rows.length>1){setPatientMatches(rows);setPatientModalOpen(true);}else{setSelectedPatient(null);setPatientId('');setMessage('No patients found for that contact');}};const filteredDoctors=useMemo(()=>{const q=doctorQuery.trim().toLowerCase();if(!q)return[];return doctors.filter(d=>d.name.toLowerCase().includes(q));},[doctorQuery,doctors]);const filteredServices=useMemo(()=>{const q=serviceSearch.trim().toLowerCase();if(!q)return[];return services.filter(s=>s.service_name.toLowerCase().includes(q)||s.service_type.toLowerCase().includes(q)).slice(0,10);// Limit to 10 results\n},[serviceSearch,services]);const onSelectDoctor=d=>{setDoctorId(d.id);setDoctorQuery(d.name);};const onSubmit=async e=>{e.preventDefault();setMessage(null);if(!patientId&&!isGuest||!doctorId){setMessage('Select patient and doctor');return;}if(isGuest&&(!guestName.trim()||!guestContact.trim())){setMessage('Enter guest name and contact');return;}if((mode==='UPI'||mode==='Card')&&!txnRef.trim()){setMessage('Transaction reference required for UPI/Card');return;}if(items.length===0&&opdFee===0){setMessage('Add at least one service or select a doctor with OPD fee');return;}setSubmitting(true);try{let finalPatientId=patientId;// Step 1: Create guest patient if needed\nif(isGuest&&guestName.trim()&&guestContact.trim()){const patient_id=generatePatientId(guestContact.trim(),guestName.trim());const age=0;// Guest patients don't have DOB, default to 0\nconst createdPatient=await createPatient({id:crypto.randomUUID(),patient_id,name:guestName.trim(),dob:new Date().toISOString().split('T')[0],// Default to today\ngender:'Other',contact:guestContact.trim(),address:'',age});finalPatientId=createdPatient.id;}// Step 2: Create appointment if needed\nlet finalAppointmentId=appointmentId;if(!finalAppointmentId&&finalPatientId&&doctorId){const appointment=await createAppointment({patient_id:finalPatientId,doctor_id:doctorId,appointment_date:new Date().toISOString().split('T')[0],// Today's date in YYYY-MM-DD\nstatus:'completed'});finalAppointmentId=appointment.id;setAppointmentId(finalAppointmentId);}// Step 3: Create bill\nconst bill_number=generateBillNumber();const billPayload={patient_id:finalPatientId,doctor_id:doctorId,total_amount:total,discount:discountAmount,net_amount:net,status,bill_number,mode_of_payment:mode,transaction_reference:mode==='UPI'||mode==='Card'?txnRef:null,guest_name:isGuest?guestName.trim():null,guest_contact:isGuest?guestContact.trim():null,bill_type:'services'};const itemsInsert=items.map(it=>({bill_id:'',service_id:it.service.id,quantity:it.quantity,price:Number(it.service.price),total:Number(it.service.price)*it.quantity}));const inserted=await createBill(billPayload,itemsInsert);// Step 4: Record payment if status is paid or partial\nif(status==='paid'&&net>0){await recordPayment(inserted.id,net,mode,mode==='UPI'||mode==='Card'?txnRef:null);}else if(status==='partial'&&net>0){// For partial payments, you could add a payment amount field\n// For now, we'll record it as paid to update the status\nawait recordPayment(inserted.id,net*0.5,// Example: 50% payment\nmode,mode==='UPI'||mode==='Card'?txnRef:null);}localStorage.setItem('orthonova_last_bill_id',inserted.id);setMessage('Bill generated successfully');// Open print window\nconst printUrl=\"\".concat(window.location.origin,\"/print/bill/\").concat(inserted.id);const win=window.open(printUrl,'_blank');if(win){win.focus();}// Reset form\nsetItems([]);setDiscountPercent(0);setMode('Cash');setTxnRef('');setStatus('paid');setAppointmentId(null);}catch(e){setMessage(e.message);}finally{setSubmitting(false);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"card p-6\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-semibold mb-4\",children:\"Generate Bill\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:onSubmit,className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium\",children:\"Patient Contact\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-2 mt-1\",children:[/*#__PURE__*/_jsx(\"input\",{placeholder:\"Enter contact number\",className:\"flex-1 rounded-xl border border-gray-300 bg-white focus:border-brand-500 focus:ring-brand-500\",value:patientSearch,onChange:e=>setPatientSearch(e.target.value),disabled:isGuest}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-secondary\",onClick:onSearchPatient,disabled:isGuest,children:\"Search\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-2\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-xs text-gray-600\",children:\"Patient Name\"}),/*#__PURE__*/_jsx(\"input\",{className:\"mt-1 w-full rounded-xl border border-gray-300 bg-gray-50\",value:(selectedPatient===null||selectedPatient===void 0?void 0:selectedPatient.name)||'',readOnly:true,placeholder:\"No patient selected\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-3 flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"input\",{id:\"guest-toggle\",type:\"checkbox\",checked:isGuest,onChange:e=>{setIsGuest(e.target.checked);if(e.target.checked){setSelectedPatient(null);setPatientId('');}}}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"guest-toggle\",className:\"text-sm\",children:\"Bill for non-registered patient\"})]}),isGuest&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-2 space-y-2\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium\",children:\"Guest Name\"}),/*#__PURE__*/_jsx(\"input\",{className:\"mt-1 w-full rounded-xl border border-gray-300 bg-white focus:border-brand-500 focus:ring-brand-500\",value:guestName,onChange:e=>setGuestName(e.target.value)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium\",children:\"Guest Contact\"}),/*#__PURE__*/_jsx(\"input\",{className:\"mt-1 w-full rounded-xl border border-gray-300 bg-white focus:border-brand-500 focus:ring-brand-500\",value:guestContact,onChange:e=>setGuestContact(e.target.value)})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium\",children:\"Doctor\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"text-xs text-brand-600 hover:text-brand-800\",onClick:refreshDoctors,children:\"Refresh List\"})]}),/*#__PURE__*/_jsx(\"input\",{placeholder:\"Type to search doctor by name\",className:\"mt-1 w-full rounded-xl border border-gray-300 bg-white focus:border-brand-500 focus:ring-brand-500\",value:doctorQuery,onChange:e=>{setDoctorQuery(e.target.value);setDoctorId('');}}),doctorQuery.trim().length>0&&!doctorId&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-2 max-h-40 overflow-y-auto border border-gray-200 rounded-xl divide-y divide-gray-100\",children:[filteredDoctors.map(d=>/*#__PURE__*/_jsx(\"div\",{className:\"px-3 py-2 cursor-pointer hover:bg-gray-50 \".concat(doctorId===d.id?'bg-brand-50':''),onClick:()=>onSelectDoctor(d),children:d.name},d.id)),filteredDoctors.length===0&&/*#__PURE__*/_jsx(\"div\",{className:\"px-3 py-2 text-sm text-gray-500\",children:\"No match\"})]}),doctor&&/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-gray-500 mt-1\",children:[\"Consultation Fee: \",formatCurrency(opdFee)]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"card p-4\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-medium mb-3\",children:\"Search Services\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Type service name or type to search...\",className:\"w-full rounded-xl border border-gray-300 bg-white focus:border-brand-500 focus:ring-brand-500 mb-2\",value:serviceSearch,onChange:e=>setServiceSearch(e.target.value)}),serviceSearch.trim().length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"max-h-48 overflow-y-auto divide-y divide-gray-100 border border-gray-200 rounded-xl\",children:[filteredServices.map(s=>/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between p-3 hover:bg-gray-50\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-medium\",children:s.service_name}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-gray-500\",children:[s.service_type,\" \\u2022 \",formatCurrency(Number(s.price))]})]}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-secondary btn-sm\",onClick:()=>{addItem(s);setServiceSearch('');},children:\"Add\"})]},s.id)),filteredServices.length===0&&/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-gray-500 p-3\",children:[\"No services found matching \\\"\",serviceSearch,\"\\\"\"]})]}),serviceSearch.trim().length===0&&/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500 text-center py-3\",children:\"Start typing to search for services\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"card p-4\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-medium mb-3\",children:\"Selected Services & Fees\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-3\",children:[items.map(it=>/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-medium\",children:it.service.service_name}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-gray-500\",children:formatCurrency(Number(it.service.price))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"number\",min:0,className:\"w-20 rounded-xl border border-gray-300 bg-white text-center\",value:it.quantity,onChange:e=>updateQty(it.service.id,Number(e.target.value))}),/*#__PURE__*/_jsx(\"div\",{className:\"w-24 text-right\",children:formatCurrency(Number(it.service.price)*it.quantity)})]})]},it.service.id)),items.length===0&&/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-500 text-center py-3\",children:\"No services added yet\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"border-t border-gray-100 mt-3 pt-3 text-sm space-y-1\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Consultation Fee\"}),/*#__PURE__*/_jsx(\"span\",{children:formatCurrency(opdFee)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Services Total\"}),/*#__PURE__*/_jsx(\"span\",{children:formatCurrency(servicesTotal)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between font-medium\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Gross Total\"}),/*#__PURE__*/_jsx(\"span\",{children:formatCurrency(total)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"border-t border-gray-100 pt-2 mt-2 flex justify-between items-center\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-xs font-medium text-gray-600\",children:\"Discount (%)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",step:\"0.01\",min:\"0\",max:\"100\",className:\"w-32 rounded-xl border border-gray-300 bg-white focus:border-brand-500 focus:ring-brand-500 text-sm text-right\",value:discountPercent,onChange:e=>setDiscountPercent(Math.min(100,Math.max(0,Number(e.target.value)))),placeholder:\"0\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between text-red-600\",children:[/*#__PURE__*/_jsxs(\"span\",{children:[\"Discount Applied (\",discountPercent,\"%)\"]}),/*#__PURE__*/_jsxs(\"span\",{children:[\"-\",formatCurrency(discountAmount)]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between text-lg font-semibold border-t border-gray-200 pt-2 mt-2\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Net Amount\"}),/*#__PURE__*/_jsx(\"span\",{children:formatCurrency(net)})]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-3 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium\",children:\"Payment Mode\"}),/*#__PURE__*/_jsx(\"select\",{className:\"mt-1 w-full rounded-xl border border-gray-300 bg-white focus:border-brand-500 focus:ring-brand-500\",value:mode,onChange:e=>setMode(e.target.value),children:MODES.map(m=>/*#__PURE__*/_jsx(\"option\",{value:m,children:m},m))})]}),(mode==='UPI'||mode==='Card')&&/*#__PURE__*/_jsxs(\"div\",{className:\"md:col-span-2\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium\",children:\"Transaction Reference\"}),/*#__PURE__*/_jsx(\"input\",{className:\"mt-1 w-full rounded-xl border border-gray-300 bg-white focus:border-brand-500 focus:ring-brand-500\",value:txnRef,onChange:e=>setTxnRef(e.target.value),required:true})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium\",children:\"Status\"}),/*#__PURE__*/_jsxs(\"select\",{className:\"mt-1 w-full rounded-xl border border-gray-300 bg-white focus:border-brand-500 focus:ring-brand-500\",value:status,onChange:e=>setStatus(e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"paid\",children:\"Paid\"}),/*#__PURE__*/_jsx(\"option\",{value:\"pending\",children:\"Pending\"}),/*#__PURE__*/_jsx(\"option\",{value:\"partial\",children:\"Partial\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary\",disabled:submitting,children:\"Generate Bill\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-secondary\",onClick:()=>{const id=localStorage.getItem('orthonova_last_bill_id');if(!id){setMessage('No recent bill to reprint');return;}const url=\"\".concat(window.location.origin,\"/print/bill/\").concat(id);const win=window.open(url,'_blank');if(win)win.focus();},children:\"Reprint Last\"})]}),message&&/*#__PURE__*/_jsx(\"p\",{className:\"text-sm mt-2\",children:message})]})]}),/*#__PURE__*/_jsx(Modal,{open:patientModalOpen,title:\"Select Patient\",onClose:()=>setPatientModalOpen(false),children:/*#__PURE__*/_jsxs(\"div\",{className:\"divide-y divide-gray-100\",children:[patientMatches.map(p=>/*#__PURE__*/_jsx(\"div\",{className:\"py-2\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"font-medium\",children:[p.name,\" \",/*#__PURE__*/_jsxs(\"span\",{className:\"text-xs text-gray-500\",children:[\"(\",p.age,\" / \",p.gender,\")\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-gray-500\",children:[p.patient_id,\" \\u2022 \",p.contact]})]}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-secondary\",onClick:()=>{setPatientId(p.id);setSelectedPatient(p);setPatientModalOpen(false);setPatientMatches([]);},children:\"Select\"})]})},p.id)),patientMatches.length===0&&/*#__PURE__*/_jsx(\"div\",{className:\"py-4 text-sm text-gray-500\",children:\"No matches.\"})]})})]});};export default BillingSystem;","map":{"version":3,"names":["React","useEffect","useMemo","useState","createPatient","createAppointment","createBill","recordPayment","listDoctors","listServices","searchPatientsByContact","formatCurrency","generateBillNumber","generatePatientId","Modal","jsx","_jsx","jsxs","_jsxs","MODES","BillingSystem","doctors","setDoctors","services","setServices","patientSearch","setPatientSearch","patientId","setPatientId","selectedPatient","setSelectedPatient","patientMatches","setPatientMatches","patientModalOpen","setPatientModalOpen","isGuest","setIsGuest","guestName","setGuestName","guestContact","setGuestContact","doctorQuery","setDoctorQuery","doctorId","setDoctorId","appointmentId","setAppointmentId","items","setItems","serviceSearch","setServiceSearch","discountPercent","setDiscountPercent","mode","setMode","txnRef","setTxnRef","status","setStatus","submitting","setSubmitting","message","setMessage","refreshDoctors","data","e","console","error","d","s","Promise","all","doctor","find","id","opdFee","Number","opd_fees","servicesTotal","reduce","sum","it","service","price","quantity","total","discountAmount","net","Math","max","addItem","prev","existing","map","_objectSpread","updateQty","serviceId","qty","filter","onSearchPatient","rows","length","filteredDoctors","q","trim","toLowerCase","name","includes","filteredServices","service_name","service_type","slice","onSelectDoctor","onSubmit","preventDefault","finalPatientId","patient_id","age","createdPatient","crypto","randomUUID","dob","Date","toISOString","split","gender","contact","address","finalAppointmentId","appointment","doctor_id","appointment_date","bill_number","billPayload","total_amount","discount","net_amount","mode_of_payment","transaction_reference","guest_name","guest_contact","bill_type","itemsInsert","bill_id","service_id","inserted","localStorage","setItem","printUrl","concat","window","location","origin","win","open","focus","className","children","placeholder","value","onChange","target","disabled","type","onClick","readOnly","checked","htmlFor","min","step","m","required","getItem","url","title","onClose","p"],"sources":["C:/Users/Me/Desktop/orthnova-app/orthnova-offline/src/components/billing/BillingSystem.tsx"],"sourcesContent":["import React, { useEffect, useMemo, useState } from 'react';\r\nimport { createPatient, createAppointment, createBill, recordPayment, listDoctors, listServices, searchPatientsByContact } from '../../api';\r\nimport { BillItemRow, DoctorRow, PatientRow, ServiceRow } from '../../types';\r\nimport { formatCurrency, generateBillNumber } from '../../utils/format';\r\nimport { calculateAge, generatePatientId } from '../../utils/idGenerators';\r\nimport Modal from '../common/Modal';\r\n\r\nconst MODES = ['Cash', 'UPI', 'Card'] as const;\r\n\r\ntype Mode = typeof MODES[number];\r\n\r\ninterface SelectedItem { service: ServiceRow; quantity: number; }\r\n\r\nconst BillingSystem: React.FC = () => {\r\n  const [doctors, setDoctors] = useState<DoctorRow[]>([]);\r\n  const [services, setServices] = useState<ServiceRow[]>([]);\r\n\r\n  const [patientSearch, setPatientSearch] = useState('');\r\n  const [patientId, setPatientId] = useState('');\r\n  const [selectedPatient, setSelectedPatient] = useState<PatientRow | null>(null);\r\n  const [patientMatches, setPatientMatches] = useState<PatientRow[]>([]);\r\n  const [patientModalOpen, setPatientModalOpen] = useState(false);\r\n\r\n  // Guest/non-registered patient support\r\n  const [isGuest, setIsGuest] = useState(false);\r\n  const [guestName, setGuestName] = useState('');\r\n  const [guestContact, setGuestContact] = useState('');\r\n\r\n  const [doctorQuery, setDoctorQuery] = useState('');\r\n  const [doctorId, setDoctorId] = useState('');\r\n  const [appointmentId, setAppointmentId] = useState<string | null>(null);\r\n\r\n  const [items, setItems] = useState<SelectedItem[]>([]);\r\n  const [serviceSearch, setServiceSearch] = useState('');\r\n  const [discountPercent, setDiscountPercent] = useState<number>(0);\r\n  const [mode, setMode] = useState<Mode>('Cash');\r\n  const [txnRef, setTxnRef] = useState('');\r\n  const [status, setStatus] = useState<'paid' | 'pending' | 'partial'>('paid');\r\n\r\n  const [submitting, setSubmitting] = useState(false);\r\n  const [message, setMessage] = useState<string | null>(null);\r\n\r\n  const refreshDoctors = async () => {\r\n    try {\r\n      const data = await listDoctors();\r\n      setDoctors(data);\r\n    } catch (e: any) {\r\n      console.error('Error refreshing doctors:', e);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      const [d, s] = await Promise.all([listDoctors(), listServices()]);\r\n      setDoctors(d); setServices(s);\r\n    })();\r\n  }, []);\r\n\r\n  const doctor = useMemo(() => doctors.find(d => d.id === doctorId) || null, [doctors, doctorId]);\r\n  const opdFee = useMemo(() => Number(doctor?.opd_fees || 0), [doctor]);\r\n\r\n  const servicesTotal = useMemo(() => items.reduce((sum, it) => sum + Number(it.service.price) * it.quantity, 0), [items]);\r\n  const total = useMemo(() => servicesTotal + opdFee, [servicesTotal, opdFee]);\r\n  const discountAmount = useMemo(() => (total * Number(discountPercent || 0)) / 100, [total, discountPercent]);\r\n  const net = useMemo(() => Math.max(0, total - discountAmount), [total, discountAmount]);\r\n\r\n  const addItem = (service: ServiceRow) => {\r\n    setItems(prev => {\r\n      const existing = prev.find(it => it.service.id === service.id);\r\n      if (existing) return prev.map(it => it.service.id === service.id ? { ...it, quantity: it.quantity + 1 } : it);\r\n      return [...prev, { service, quantity: 1 }];\r\n    });\r\n  };\r\n\r\n  const updateQty = (serviceId: string, qty: number) => {\r\n    if (qty <= 0) {\r\n      setItems(prev => prev.filter(it => it.service.id !== serviceId));\r\n    } else {\r\n      setItems(prev => prev.map(it => it.service.id === serviceId ? { ...it, quantity: qty } : it));\r\n    }\r\n  };\r\n\r\n  const onSearchPatient = async () => {\r\n    setMessage(null);\r\n    if (isGuest) return; // skip search in guest mode\r\n    const rows = await searchPatientsByContact(patientSearch);\r\n    if (rows.length === 1) {\r\n      setPatientId(rows[0].id);\r\n      setSelectedPatient(rows[0]);\r\n      setPatientMatches([]);\r\n    } else if (rows.length > 1) {\r\n      setPatientMatches(rows);\r\n      setPatientModalOpen(true);\r\n    } else {\r\n      setSelectedPatient(null);\r\n      setPatientId('');\r\n      setMessage('No patients found for that contact');\r\n    }\r\n  };\r\n\r\n  const filteredDoctors = useMemo(() => {\r\n    const q = doctorQuery.trim().toLowerCase();\r\n    if (!q) return [];\r\n    return doctors.filter(d => d.name.toLowerCase().includes(q));\r\n  }, [doctorQuery, doctors]);\r\n\r\n  const filteredServices = useMemo(() => {\r\n    const q = serviceSearch.trim().toLowerCase();\r\n    if (!q) return [];\r\n    return services.filter(s => \r\n      s.service_name.toLowerCase().includes(q) || \r\n      s.service_type.toLowerCase().includes(q)\r\n    ).slice(0, 10); // Limit to 10 results\r\n  }, [serviceSearch, services]);\r\n\r\n  const onSelectDoctor = (d: DoctorRow) => {\r\n    setDoctorId(d.id);\r\n    setDoctorQuery(d.name);\r\n  };\r\n\r\n  const onSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setMessage(null);\r\n    \r\n    if ((!patientId && !isGuest) || !doctorId) {\r\n      setMessage('Select patient and doctor');\r\n      return;\r\n    }\r\n    if (isGuest && (!guestName.trim() || !guestContact.trim())) {\r\n      setMessage('Enter guest name and contact');\r\n      return;\r\n    }\r\n    if ((mode === 'UPI' || mode === 'Card') && !txnRef.trim()) {\r\n      setMessage('Transaction reference required for UPI/Card');\r\n      return;\r\n    }\r\n    if (items.length === 0 && opdFee === 0) {\r\n      setMessage('Add at least one service or select a doctor with OPD fee');\r\n      return;\r\n    }\r\n\r\n    setSubmitting(true);\r\n    try {\r\n      let finalPatientId = patientId;\r\n\r\n      // Step 1: Create guest patient if needed\r\n      if (isGuest && guestName.trim() && guestContact.trim()) {\r\n        const patient_id = generatePatientId(guestContact.trim(), guestName.trim());\r\n        const age = 0; // Guest patients don't have DOB, default to 0\r\n        const createdPatient = await createPatient({\r\n          id: crypto.randomUUID(),\r\n          patient_id,\r\n          name: guestName.trim(),\r\n          dob: new Date().toISOString().split('T')[0], // Default to today\r\n          gender: 'Other',\r\n          contact: guestContact.trim(),\r\n          address: '',\r\n          age,\r\n        });\r\n        finalPatientId = createdPatient.id;\r\n      }\r\n\r\n      // Step 2: Create appointment if needed\r\n      let finalAppointmentId = appointmentId;\r\n      if (!finalAppointmentId && finalPatientId && doctorId) {\r\n        const appointment = await createAppointment({\r\n          patient_id: finalPatientId,\r\n          doctor_id: doctorId,\r\n          appointment_date: new Date().toISOString().split('T')[0], // Today's date in YYYY-MM-DD\r\n          status: 'completed',\r\n        });\r\n        finalAppointmentId = appointment.id;\r\n        setAppointmentId(finalAppointmentId);\r\n      }\r\n\r\n      // Step 3: Create bill\r\n      const bill_number = generateBillNumber();\r\n      const billPayload = {\r\n        patient_id: finalPatientId,\r\n        doctor_id: doctorId,\r\n        total_amount: total,\r\n        discount: discountAmount,\r\n        net_amount: net,\r\n        status,\r\n        bill_number,\r\n        mode_of_payment: mode,\r\n        transaction_reference: (mode === 'UPI' || mode === 'Card') ? txnRef : null,\r\n        guest_name: isGuest ? guestName.trim() : null,\r\n        guest_contact: isGuest ? guestContact.trim() : null,\r\n        bill_type: 'services' as const,\r\n      };\r\n\r\n      const itemsInsert: Array<Omit<BillItemRow, 'id'>> = items.map(it => ({\r\n        bill_id: '',\r\n        service_id: it.service.id,\r\n        quantity: it.quantity,\r\n        price: Number(it.service.price),\r\n        total: Number(it.service.price) * it.quantity,\r\n      }));\r\n\r\n      const inserted = await createBill(billPayload as any, itemsInsert);\r\n\r\n      // Step 4: Record payment if status is paid or partial\r\n      if (status === 'paid' && net > 0) {\r\n        await recordPayment(\r\n          inserted.id,\r\n          net,\r\n          mode,\r\n          (mode === 'UPI' || mode === 'Card') ? txnRef : null\r\n        );\r\n      } else if (status === 'partial' && net > 0) {\r\n        // For partial payments, you could add a payment amount field\r\n        // For now, we'll record it as paid to update the status\r\n        await recordPayment(\r\n          inserted.id,\r\n          net * 0.5, // Example: 50% payment\r\n          mode,\r\n          (mode === 'UPI' || mode === 'Card') ? txnRef : null\r\n        );\r\n      }\r\n\r\n      localStorage.setItem('orthonova_last_bill_id', inserted.id);\r\n      setMessage('Bill generated successfully');\r\n      \r\n      // Open print window\r\n      const printUrl = `${window.location.origin}/print/bill/${inserted.id}`;\r\n      const win = window.open(printUrl, '_blank');\r\n      if (win) {\r\n        win.focus();\r\n      }\r\n      \r\n      // Reset form\r\n      setItems([]);\r\n      setDiscountPercent(0);\r\n      setMode('Cash');\r\n      setTxnRef('');\r\n      setStatus('paid');\r\n      setAppointmentId(null);\r\n    } catch (e: any) {\r\n      setMessage(e.message);\r\n    } finally {\r\n      setSubmitting(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div className=\"card p-6\">\r\n        <h2 className=\"text-xl font-semibold mb-4\">Generate Bill</h2>\r\n        <form onSubmit={onSubmit} className=\"space-y-4\">\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n            <div>\r\n              <label className=\"block text-sm font-medium\">Patient Contact</label>\r\n              <div className=\"flex gap-2 mt-1\">\r\n                <input\r\n                  placeholder=\"Enter contact number\"\r\n                  className=\"flex-1 rounded-xl border border-gray-300 bg-white focus:border-brand-500 focus:ring-brand-500\"\r\n                  value={patientSearch}\r\n                  onChange={e => setPatientSearch(e.target.value)}\r\n                  disabled={isGuest}\r\n                />\r\n                <button type=\"button\" className=\"btn btn-secondary\" onClick={onSearchPatient} disabled={isGuest}>Search</button>\r\n              </div>\r\n              <div className=\"mt-2\">\r\n                <label className=\"block text-xs text-gray-600\">Patient Name</label>\r\n                <input className=\"mt-1 w-full rounded-xl border border-gray-300 bg-gray-50\" value={selectedPatient?.name || ''} readOnly placeholder=\"No patient selected\" />\r\n              </div>\r\n              <div className=\"mt-3 flex items-center gap-2\">\r\n                <input id=\"guest-toggle\" type=\"checkbox\" checked={isGuest} onChange={e => { setIsGuest(e.target.checked); if (e.target.checked) { setSelectedPatient(null); setPatientId(''); } }} />\r\n                <label htmlFor=\"guest-toggle\" className=\"text-sm\">Bill for non-registered patient</label>\r\n              </div>\r\n              {isGuest && (\r\n                <div className=\"mt-2 space-y-2\">\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium\">Guest Name</label>\r\n                    <input className=\"mt-1 w-full rounded-xl border border-gray-300 bg-white focus:border-brand-500 focus:ring-brand-500\" value={guestName} onChange={e => setGuestName(e.target.value)} />\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium\">Guest Contact</label>\r\n                    <input className=\"mt-1 w-full rounded-xl border border-gray-300 bg-white focus:border-brand-500 focus:ring-brand-500\" value={guestContact} onChange={e => setGuestContact(e.target.value)} />\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </div>\r\n            <div>\r\n              <div className=\"flex items-center justify-between\">\r\n                <label className=\"block text-sm font-medium\">Doctor</label>\r\n                <button \r\n                  type=\"button\" \r\n                  className=\"text-xs text-brand-600 hover:text-brand-800\"\r\n                  onClick={refreshDoctors}\r\n                >\r\n                  Refresh List\r\n                </button>\r\n              </div>\r\n              <input\r\n                placeholder=\"Type to search doctor by name\"\r\n                className=\"mt-1 w-full rounded-xl border border-gray-300 bg-white focus:border-brand-500 focus:ring-brand-500\"\r\n                value={doctorQuery}\r\n                onChange={e => { setDoctorQuery(e.target.value); setDoctorId(''); }}\r\n              />\r\n              {doctorQuery.trim().length > 0 && !doctorId && (\r\n                <div className=\"mt-2 max-h-40 overflow-y-auto border border-gray-200 rounded-xl divide-y divide-gray-100\">\r\n                  {filteredDoctors.map(d => (\r\n                    <div key={d.id} className={`px-3 py-2 cursor-pointer hover:bg-gray-50 ${doctorId === d.id ? 'bg-brand-50' : ''}`} onClick={() => onSelectDoctor(d)}>\r\n                      {d.name}\r\n                    </div>\r\n                  ))}\r\n                  {filteredDoctors.length === 0 && <div className=\"px-3 py-2 text-sm text-gray-500\">No match</div>}\r\n                </div>\r\n              )}\r\n              {doctor && <p className=\"text-xs text-gray-500 mt-1\">Consultation Fee: {formatCurrency(opdFee)}</p>}\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"grid grid-cols-1 gap-4\">\r\n            <div className=\"card p-4\">\r\n              <h3 className=\"font-medium mb-3\">Search Services</h3>\r\n              <input\r\n                type=\"text\"\r\n                placeholder=\"Type service name or type to search...\"\r\n                className=\"w-full rounded-xl border border-gray-300 bg-white focus:border-brand-500 focus:ring-brand-500 mb-2\"\r\n                value={serviceSearch}\r\n                onChange={e => setServiceSearch(e.target.value)}\r\n              />\r\n              {serviceSearch.trim().length > 0 && (\r\n                <div className=\"max-h-48 overflow-y-auto divide-y divide-gray-100 border border-gray-200 rounded-xl\">\r\n                  {filteredServices.map(s => (\r\n                    <div key={s.id} className=\"flex items-center justify-between p-3 hover:bg-gray-50\">\r\n                      <div>\r\n                        <div className=\"font-medium\">{s.service_name}</div>\r\n                        <div className=\"text-xs text-gray-500\">{s.service_type} • {formatCurrency(Number(s.price))}</div>\r\n                      </div>\r\n                      <button \r\n                        type=\"button\" \r\n                        className=\"btn btn-secondary btn-sm\" \r\n                        onClick={() => {\r\n                          addItem(s);\r\n                          setServiceSearch('');\r\n                        }}\r\n                      >\r\n                        Add\r\n                      </button>\r\n                    </div>\r\n                  ))}\r\n                  {filteredServices.length === 0 && (\r\n                    <div className=\"text-sm text-gray-500 p-3\">No services found matching \"{serviceSearch}\"</div>\r\n                  )}\r\n                </div>\r\n              )}\r\n              {serviceSearch.trim().length === 0 && (\r\n                <p className=\"text-sm text-gray-500 text-center py-3\">Start typing to search for services</p>\r\n              )}\r\n            </div>\r\n\r\n            <div className=\"card p-4\">\r\n              <h3 className=\"font-medium mb-3\">Selected Services & Fees</h3>\r\n              <div className=\"space-y-3\">\r\n                {items.map(it => (\r\n                  <div key={it.service.id} className=\"flex items-center justify-between\">\r\n                    <div>\r\n                      <div className=\"font-medium\">{it.service.service_name}</div>\r\n                      <div className=\"text-xs text-gray-500\">{formatCurrency(Number(it.service.price))}</div>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input type=\"number\" min={0} className=\"w-20 rounded-xl border border-gray-300 bg-white text-center\" value={it.quantity} onChange={e => updateQty(it.service.id, Number(e.target.value))} />\r\n                      <div className=\"w-24 text-right\">{formatCurrency(Number(it.service.price) * it.quantity)}</div>\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n                {items.length === 0 && <div className=\"text-sm text-gray-500 text-center py-3\">No services added yet</div>}\r\n              </div>\r\n              <div className=\"border-t border-gray-100 mt-3 pt-3 text-sm space-y-1\">\r\n                <div className=\"flex justify-between\"><span>Consultation Fee</span><span>{formatCurrency(opdFee)}</span></div>\r\n                <div className=\"flex justify-between\"><span>Services Total</span><span>{formatCurrency(servicesTotal)}</span></div>\r\n                <div className=\"flex justify-between font-medium\"><span>Gross Total</span><span>{formatCurrency(total)}</span></div>\r\n                <div className=\"border-t border-gray-100 pt-2 mt-2 flex justify-between items-center\">\r\n                  <label className=\"text-xs font-medium text-gray-600\">Discount (%)</label>\r\n                  <input \r\n                    type=\"number\" \r\n                    step=\"0.01\" \r\n                    min=\"0\"\r\n                    max=\"100\"\r\n                    className=\"w-32 rounded-xl border border-gray-300 bg-white focus:border-brand-500 focus:ring-brand-500 text-sm text-right\" \r\n                    value={discountPercent} \r\n                    onChange={e => setDiscountPercent(Math.min(100, Math.max(0, Number(e.target.value))))} \r\n                    placeholder=\"0\"\r\n                  />\r\n                </div>\r\n                <div className=\"flex justify-between text-red-600\"><span>Discount Applied ({discountPercent}%)</span><span>-{formatCurrency(discountAmount)}</span></div>\r\n                <div className=\"flex justify-between text-lg font-semibold border-t border-gray-200 pt-2 mt-2\"><span>Net Amount</span><span>{formatCurrency(net)}</span></div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n            <div>\r\n              <label className=\"block text-sm font-medium\">Payment Mode</label>\r\n              <select className=\"mt-1 w-full rounded-xl border border-gray-300 bg-white focus:border-brand-500 focus:ring-brand-500\" value={mode} onChange={e => setMode(e.target.value as Mode)}>\r\n                {MODES.map(m => <option key={m} value={m}>{m}</option>)}\r\n              </select>\r\n            </div>\r\n            {(mode === 'UPI' || mode === 'Card') && (\r\n              <div className=\"md:col-span-2\">\r\n                <label className=\"block text-sm font-medium\">Transaction Reference</label>\r\n                <input className=\"mt-1 w-full rounded-xl border border-gray-300 bg-white focus:border-brand-500 focus:ring-brand-500\" value={txnRef} onChange={e => setTxnRef(e.target.value)} required />\r\n              </div>\r\n            )}\r\n            <div>\r\n              <label className=\"block text-sm font-medium\">Status</label>\r\n              <select className=\"mt-1 w-full rounded-xl border border-gray-300 bg-white focus:border-brand-500 focus:ring-brand-500\" value={status} onChange={e => setStatus(e.target.value as any)}>\r\n                <option value=\"paid\">Paid</option>\r\n                <option value=\"pending\">Pending</option>\r\n                <option value=\"partial\">Partial</option>\r\n              </select>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"flex items-center gap-3\">\r\n            <button className=\"btn btn-primary\" disabled={submitting}>Generate Bill</button>\r\n            <button type=\"button\" className=\"btn btn-secondary\" onClick={() => {\r\n              const id = localStorage.getItem('orthonova_last_bill_id');\r\n              if (!id) { setMessage('No recent bill to reprint'); return; }\r\n              const url = `${window.location.origin}/print/bill/${id}`;\r\n              const win = window.open(url, '_blank'); if (win) win.focus();\r\n            }}>Reprint Last</button>\r\n          </div>\r\n          {message && <p className=\"text-sm mt-2\">{message}</p>}\r\n        </form>\r\n      </div>\r\n\r\n      <Modal open={patientModalOpen} title=\"Select Patient\" onClose={() => setPatientModalOpen(false)}>\r\n        <div className=\"divide-y divide-gray-100\">\r\n          {patientMatches.map(p => (\r\n            <div key={p.id} className=\"py-2\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                  <div className=\"font-medium\">{p.name} <span className=\"text-xs text-gray-500\">({p.age} / {p.gender})</span></div>\r\n                  <div className=\"text-xs text-gray-500\">{p.patient_id} • {p.contact}</div>\r\n                </div>\r\n                <button className=\"btn btn-secondary\" onClick={() => { setPatientId(p.id); setSelectedPatient(p); setPatientModalOpen(false); setPatientMatches([]); }}>Select</button>\r\n              </div>\r\n            </div>\r\n          ))}\r\n          {patientMatches.length === 0 && <div className=\"py-4 text-sm text-gray-500\">No matches.</div>}\r\n        </div>\r\n      </Modal>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default BillingSystem;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}