{"ast":null,"code":"import React,{useEffect,useMemo,useState}from'react';import{createAppointment,listAppointments,listDoctors,listServices,searchPatientsByContact,listDoctorAvailability}from'../../api';import Modal from'../common/Modal';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function formatTime(date){const hours=date.getHours().toString().padStart(2,'0');const minutes=date.getMinutes().toString().padStart(2,'0');return\"\".concat(hours,\":\").concat(minutes);}function toDateInputValue(d){const pad=n=>n.toString().padStart(2,'0');return\"\".concat(d.getFullYear(),\"-\").concat(pad(d.getMonth()+1),\"-\").concat(pad(d.getDate()));}const START_HOUR=8;const END_HOUR=20;const AppointmentBooking=()=>{// Data\nconst[doctors,setDoctors]=useState([]);const[services,setServices]=useState([]);// Filters at top\nconst[filterDate,setFilterDate]=useState(toDateInputValue(new Date()));const[filterDoctorQuery,setFilterDoctorQuery]=useState('');const[filterDoctor,setFilterDoctor]=useState(null);// Booking doctor (same as filter selection)\nconst doctor=filterDoctor;// Patient\nconst[mode,setMode]=useState('registered');const[patientSearch,setPatientSearch]=useState('');const[patient,setPatient]=useState(null);const[patientMatches,setPatientMatches]=useState([]);const[patientModalOpen,setPatientModalOpen]=useState(false);// Guest\nconst[guestName,setGuestName]=useState('');const[guestContact,setGuestContact]=useState('');// Booking date/time\nconst[date,setDate]=useState(toDateInputValue(new Date()));const[timeValue,setTimeValue]=useState('');const[notes,setNotes]=useState('');const[message,setMessage]=useState(null);// Calendar\nconst[appointments,setAppointments]=useState([]);// Add doctor availability state\nconst[doctorAvailability,setDoctorAvailability]=useState([]);// Selected service (dropdown)\nconst[serviceQuery,setServiceQuery]=useState('');const[selectedService,setSelectedService]=useState(null);const refreshDoctors=async()=>{try{const data=await listDoctors();setDoctors(data);}catch(e){console.error('Error refreshing doctors:',e);}};useEffect(()=>{(async()=>{const[d,s]=await Promise.all([listDoctors(),listServices()]);setDoctors(d);setServices(s);setFilterDate(toDateInputValue(new Date()));})();},[]);// filter doctors for dropdown\nconst filteredDoctors=useMemo(()=>{const q=filterDoctorQuery.trim().toLowerCase();if(!q)return doctors;return doctors.filter(d=>d.name.toLowerCase().includes(q));},[filterDoctorQuery,doctors]);// filter services for dropdown\nconst filteredServices=useMemo(()=>{const q=serviceQuery.trim().toLowerCase();if(!q)return services;return services.filter(s=>s.service_name.toLowerCase().includes(q)||s.service_type.toLowerCase().includes(q));},[serviceQuery,services]);const onSearchPatient=async()=>{setMessage(null);const rows=await searchPatientsByContact(patientSearch);if(rows.length===1){setPatient(rows[0]);setPatientMatches([]);}else if(rows.length>1){setPatientMatches(rows);setPatientModalOpen(true);}else{setPatient(null);setMessage('No patients found for that contact');}};// Load appointments when doctor or date changes\nuseEffect(()=>{(async()=>{if(!doctor){setAppointments([]);setDoctorAvailability([]);return;}const list=await listAppointments({doctor_id:doctor.id,appointment_date_exact:date});setAppointments(list);// Load doctor availability\ntry{const availability=await listDoctorAvailability(doctor.id);setDoctorAvailability(availability);}catch(err){console.error('Failed to load doctor availability:',err);setDoctorAvailability([]);}})();},[doctor,date]);// Slots for chosen booking date\nconst slots=useMemo(()=>{const[y,m,d]=date.split('-').map(Number);const base=new Date(y,m-1,d,START_HOUR,0,0,0);const arr=[];const end=new Date(y,m-1,d,END_HOUR,0,0,0);let cur=new Date(base);while(cur<=end){arr.push({time:formatTime(cur),date:new Date(cur)});cur=new Date(cur.getTime()+15*60*1000);}return arr;},[date]);// Check if a time slot is available based on doctor's availability settings\nconst isTimeSlotAvailable=(slotTime,slotDate)=>{// If no availability data, assume doctor is available from START_HOUR to END_HOUR (default behavior)\nif(doctorAvailability.length===0){const[slotHours,slotMinutes]=slotTime.split(':').map(Number);const slotTimeInMinutes=slotHours*60+slotMinutes;// Default availability: START_HOUR to END_HOUR\nconst defaultStartTime=START_HOUR*60;const defaultEndTime=END_HOUR*60;return slotTimeInMinutes>=defaultStartTime&&slotTimeInMinutes<defaultEndTime;}const slotDateString=slotDate.toISOString().split('T')[0];// YYYY-MM-DD format\nconst dayOfWeek=slotDate.getDay();// 0 = Sunday, 6 = Saturday\n// Check for specific date availability first (higher priority)\nconst specificDateEntries=doctorAvailability.filter(a=>a.specific_date===slotDateString);// If we have specific date entries, check those first\nif(specificDateEntries.length>0){// Check if any specific entry marks the doctor as unavailable\nconst unavailableEntry=specificDateEntries.find(a=>!a.is_available);if(unavailableEntry){// Doctor is explicitly marked as unavailable for this specific date\nreturn false;}// Check if any specific entry marks the doctor as available and the time falls within range\nconst availableEntries=specificDateEntries.filter(a=>a.is_available);if(availableEntries.length>0){return isTimeWithinAvailability(slotTime,availableEntries);}// If only unavailable entries exist for this specific date, doctor is not available\nreturn false;}// Check for recurring availability\nconst recurringEntries=doctorAvailability.filter(a=>a.day_of_week===dayOfWeek&&a.specific_date===null);// If we have recurring entries, check those\nif(recurringEntries.length>0){// Check if any recurring entry marks the doctor as unavailable\nconst unavailableEntry=recurringEntries.find(a=>!a.is_available);if(unavailableEntry){// Doctor is explicitly marked as unavailable for this day of week\nreturn false;}// Check if any recurring entry marks the doctor as available and the time falls within range\nconst availableEntries=recurringEntries.filter(a=>a.is_available);if(availableEntries.length>0){return isTimeWithinAvailability(slotTime,availableEntries);}// If only unavailable entries exist for this day of week, doctor is not available\nreturn false;}// No availability found for this date/time\nreturn false;};// Helper function to check if a time is within availability ranges\nconst isTimeWithinAvailability=(slotTime,availabilityList)=>{const[slotHours,slotMinutes]=slotTime.split(':').map(Number);const slotTimeInMinutes=slotHours*60+slotMinutes;for(const availability of availabilityList){const[startHours,startMinutes]=availability.start_time.split(':').map(Number);const[endHours,endMinutes]=availability.end_time.split(':').map(Number);const startTimeInMinutes=startHours*60+startMinutes;const endTimeInMinutes=endHours*60+endMinutes;// Check if slot time falls within this availability range\nif(slotTimeInMinutes>=startTimeInMinutes&&slotTimeInMinutes<endTimeInMinutes){return true;}}return false;};const bookedSlots=useMemo(()=>{if(!doctor)return new Set();const set=new Set();// For each appointment, find which slot it belongs to\nappointments.forEach(a=>{if(a.doctor_id!==doctor.id)return;// Use appointment_datetime if available, otherwise use appointment_date with time from created_at\nlet appointmentDate;if(a.appointment_datetime){// Use the full datetime if available\nappointmentDate=new Date(a.appointment_datetime);}else if(a.appointment_date){// Parse the appointment_date (YYYY-MM-DD format) and combine with time from created_at\nconst datePart=a.appointment_date;// Already in YYYY-MM-DD format\n// Use the time from created_at\nconst timePart=new Date(a.created_at).toTimeString().split(' ')[0];// Get HH:MM:SS\nappointmentDate=new Date(\"\".concat(datePart,\"T\").concat(timePart));}else{appointmentDate=new Date(a.created_at);}// Validate that we have a valid date\nif(isNaN(appointmentDate.getTime())){return;}// Find the slot that this appointment belongs to by checking which 15-minute window it falls in\nappointmentDate.setSeconds(0,0);const hours=appointmentDate.getHours();const minutes=appointmentDate.getMinutes();// Validate that hours and minutes are valid numbers\nif(isNaN(hours)||isNaN(minutes)){return;}const appointmentMinutes=hours*60+minutes;// Round down to the nearest 15-minute slot\nconst slotMinutes=Math.floor(appointmentMinutes/15)*15;const slotHours=Math.floor(slotMinutes/60);const slotMinute=slotMinutes%60;// Format as HH:MM\nconst slotTime=\"\".concat(slotHours.toString().padStart(2,'0'),\":\").concat(slotMinute.toString().padStart(2,'0'));set.add(slotTime);});return set;},[appointments,doctor,date]);const onPickSlot=slotTime=>{setTimeValue(slotTime);};const onSubmit=async e=>{e.preventDefault();setMessage(null);if(!doctor){setMessage('Select doctor');return;}if(!date||!timeValue){setMessage('Pick date and time');return;}if(mode==='guest'){if(!guestName.trim()||!guestContact.trim()){setMessage('Enter guest name and contact');return;}}else{if(!patient&&!patientSearch.trim()){setMessage('Enter contact and search patient');return;}}const[hh,mm]=timeValue.split(':').map(Number);const[y,m,d]=date.split('-').map(Number);const dt=new Date(y,m-1,d,hh,mm,0,0);try{await createAppointment({patient_id:mode==='guest'?null:(patient===null||patient===void 0?void 0:patient.id)||null,doctor_id:doctor.id,appointment_date:date,// YYYY-MM-DD format\nappointment_datetime:dt.toISOString(),// Full datetime\nstatus:'booked'});setMessage('Appointment booked');setNotes('');// Refresh appointments to show the newly booked appointment\nif(doctor){// Add a small delay to ensure the database has time to update\nawait new Promise(resolve=>setTimeout(resolve,500));const list=await listAppointments({doctor_id:doctor.id,appointment_date_exact:date});setAppointments(list);}}catch(e){setMessage(e.message);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"card p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium\",children:\"Date\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",className:\"mt-1 w-full\",value:filterDate,onChange:e=>{setFilterDate(e.target.value);setDate(e.target.value);}})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium\",children:\"Doctor Name\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"text-xs text-brand-600 hover:text-brand-800\",onClick:refreshDoctors,children:\"Refresh List\"})]}),/*#__PURE__*/_jsx(\"input\",{className:\"mt-1 w-full\",placeholder:\"Search doctor\",value:filterDoctorQuery,onChange:e=>{setFilterDoctorQuery(e.target.value);if(filterDoctor&&e.target.value!==filterDoctor.name)setFilterDoctor(null);}}),filterDoctorQuery.trim()&&!filterDoctor&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-2 max-h-40 overflow-y-auto border border-gray-200 rounded-xl divide-y divide-gray-100\",children:[filteredDoctors.map(d=>/*#__PURE__*/_jsx(\"div\",{className:\"px-3 py-2 cursor-pointer hover:bg-gray-50 \".concat((doctor===null||doctor===void 0?void 0:doctor.id)===d.id?'bg-brand-50':''),onClick:()=>{setFilterDoctor(d);setFilterDoctorQuery(d.name);},children:d.name},d.id)),filteredDoctors.length===0&&/*#__PURE__*/_jsx(\"div\",{className:\"px-3 py-2 text-sm text-gray-500\",children:\"No match\"})]})]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-3 gap-6 items-start\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"md:col-span-1 space-y-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"card p-5\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-lg font-semibold mb-3\",children:\"Booking Details\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-4\",children:[/*#__PURE__*/_jsxs(\"label\",{className:\"inline-flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",checked:mode==='registered',onChange:()=>setMode('registered')}),\"Appointment\"]}),/*#__PURE__*/_jsxs(\"label\",{className:\"inline-flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",checked:mode==='guest',onChange:()=>setMode('guest')}),\"New Registration\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4 space-y-3\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium\",children:\"Name\"}),/*#__PURE__*/_jsx(\"input\",{className:\"mt-1 w-full\",value:mode==='guest'?guestName:(patient===null||patient===void 0?void 0:patient.name)||'',onChange:e=>mode==='guest'?setGuestName(e.target.value):setPatientSearch(e.target.value),placeholder:\"Patient/Guest name\",readOnly:mode==='registered'&&!patient})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium\",children:\"Contact\"}),mode==='registered'?/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-2 mt-1\",children:[/*#__PURE__*/_jsx(\"input\",{className:\"flex-1\",placeholder:\"Enter contact number\",value:patientSearch,onChange:e=>setPatientSearch(e.target.value)}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-secondary\",onClick:onSearchPatient,children:\"Search\"})]}):/*#__PURE__*/_jsx(\"input\",{className:\"mt-1 w-full\",value:guestContact,onChange:e=>setGuestContact(e.target.value),placeholder:\"Guest contact\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium\",children:\"Date\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",className:\"mt-1 w-full\",value:date,onChange:e=>setDate(e.target.value)})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium\",children:\"Notes\"}),/*#__PURE__*/_jsx(\"input\",{className:\"mt-1 w-full\",value:notes,onChange:e=>setNotes(e.target.value),placeholder:\"Optional\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-4 flex items-center gap-3\",children:/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary\",onClick:onSubmit,children:\"Book\"})}),message&&/*#__PURE__*/_jsx(\"p\",{className:\"text-sm mt-2\",children:message})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"md:col-span-2 flex flex-col gap-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"card p-5\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-500\",children:\"DATE\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xl font-semibold\",children:new Date(date).toLocaleDateString('en-IN',{year:'numeric',month:'long',day:'numeric'})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"inline-flex items-center gap-1 text-sm\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"w-3 h-3 inline-block rounded bg-green-200 border border-green-400\"}),\" Available\"]}),/*#__PURE__*/_jsxs(\"span\",{className:\"inline-flex items-center gap-1 text-sm\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"w-3 h-3 inline-block rounded bg-red-200 border border-red-400\"}),\" Booked\"]})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"card p-5 max-h-[620px] overflow-y-auto\",children:/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3\",children:slots.map(_ref=>{let{time,date}=_ref;// Calculate the end time for this slot (15 minutes later)\nconst[hours,minutes]=time.split(':').map(Number);const slotDate=new Date(date);slotDate.setHours(hours,minutes,0,0);const endTime=new Date(slotDate.getTime()+15*60000);const endTimeString=formatTime(endTime);// Check if slot is available based on doctor's schedule\nconst isAvailable=isTimeSlotAvailable(time,date);const isBooked=bookedSlots.has(time);const isSelected=timeValue===time;// Check if slot is booked\nif(isBooked){console.log('Slot',time,'is booked');}// Slot is available only if it's within doctor's availability and not already booked\nconst slotAvailable=isAvailable&&!isBooked;return/*#__PURE__*/_jsxs(\"button\",{type:\"button\",onClick:()=>slotAvailable&&onPickSlot(time),className:\"p-3 rounded-lg border transition text-center \".concat(!isAvailable?'bg-gray-100 border-gray-300 text-gray-500 cursor-not-allowed':isBooked?'bg-red-100 border-red-300 text-red-800 cursor-not-allowed':isSelected?'bg-blue-100 border-blue-300 text-blue-800':'bg-green-100 border-green-300 text-green-800 hover:bg-green-200'),disabled:!slotAvailable,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"font-medium\",children:[time,\" - \",endTimeString]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs mt-1\",children:!isAvailable?'Not Available':isBooked?'Booked':isSelected?'Selected':'Available'})]},time);})})})]})]}),/*#__PURE__*/_jsx(Modal,{open:patientModalOpen,title:\"Select Patient\",onClose:()=>setPatientModalOpen(false),children:/*#__PURE__*/_jsxs(\"div\",{className:\"divide-y divide-gray-100\",children:[patientMatches.map(p=>/*#__PURE__*/_jsx(\"div\",{className:\"py-2\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"font-medium\",children:[p.name,\" \",/*#__PURE__*/_jsxs(\"span\",{className:\"text-xs text-gray-500\",children:[\"(\",p.age,\" / \",p.gender,\")\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-gray-500\",children:[p.id,\" \\u2022 \",p.contact]})]}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-secondary\",onClick:()=>{setPatient(p);setPatientModalOpen(false);setPatientMatches([]);},children:\"Select\"})]})},p.id)),patientMatches.length===0&&/*#__PURE__*/_jsx(\"div\",{className:\"py-4 text-sm text-gray-500\",children:\"No matches.\"})]})})]});};export default AppointmentBooking;","map":{"version":3,"names":["React","useEffect","useMemo","useState","createAppointment","listAppointments","listDoctors","listServices","searchPatientsByContact","listDoctorAvailability","Modal","jsx","_jsx","jsxs","_jsxs","formatTime","date","hours","getHours","toString","padStart","minutes","getMinutes","concat","toDateInputValue","d","pad","n","getFullYear","getMonth","getDate","START_HOUR","END_HOUR","AppointmentBooking","doctors","setDoctors","services","setServices","filterDate","setFilterDate","Date","filterDoctorQuery","setFilterDoctorQuery","filterDoctor","setFilterDoctor","doctor","mode","setMode","patientSearch","setPatientSearch","patient","setPatient","patientMatches","setPatientMatches","patientModalOpen","setPatientModalOpen","guestName","setGuestName","guestContact","setGuestContact","setDate","timeValue","setTimeValue","notes","setNotes","message","setMessage","appointments","setAppointments","doctorAvailability","setDoctorAvailability","serviceQuery","setServiceQuery","selectedService","setSelectedService","refreshDoctors","data","e","console","error","s","Promise","all","filteredDoctors","q","trim","toLowerCase","filter","name","includes","filteredServices","service_name","service_type","onSearchPatient","rows","length","list","doctor_id","id","appointment_date_exact","availability","err","slots","y","m","split","map","Number","base","arr","end","cur","push","time","getTime","isTimeSlotAvailable","slotTime","slotDate","slotHours","slotMinutes","slotTimeInMinutes","defaultStartTime","defaultEndTime","slotDateString","toISOString","dayOfWeek","getDay","specificDateEntries","a","specific_date","unavailableEntry","find","is_available","availableEntries","isTimeWithinAvailability","recurringEntries","day_of_week","availabilityList","startHours","startMinutes","start_time","endHours","endMinutes","end_time","startTimeInMinutes","endTimeInMinutes","bookedSlots","Set","set","forEach","appointmentDate","appointment_datetime","appointment_date","datePart","timePart","created_at","toTimeString","isNaN","setSeconds","appointmentMinutes","Math","floor","slotMinute","add","onPickSlot","onSubmit","preventDefault","hh","mm","dt","patient_id","status","resolve","setTimeout","className","children","type","value","onChange","target","onClick","placeholder","checked","readOnly","toLocaleDateString","year","month","day","_ref","setHours","endTime","endTimeString","isAvailable","isBooked","has","isSelected","log","slotAvailable","disabled","open","title","onClose","p","age","gender","contact"],"sources":["C:/Users/Me/Desktop/orthnova-app/orthnova-offline/src/components/appointments/AppointmentBooking.tsx"],"sourcesContent":["import React, { useEffect, useMemo, useState } from 'react';\r\nimport { createAppointment, listAppointments, listDoctors, listServices, searchPatientsByContact, listDoctorAvailability } from '../../api';\r\nimport { DoctorRow, PatientRow, ServiceRow, DoctorAvailabilityRow } from '../../types';\r\nimport Modal from '../common/Modal';\r\n\r\nfunction formatTime(date: Date): string {\r\n  const hours = date.getHours().toString().padStart(2, '0');\r\n  const minutes = date.getMinutes().toString().padStart(2, '0');\r\n  return `${hours}:${minutes}`;\r\n}\r\n\r\nfunction toDateInputValue(d: Date): string {\r\n  const pad = (n: number) => n.toString().padStart(2, '0');\r\n  return `${d.getFullYear()}-${pad(d.getMonth() + 1)}-${pad(d.getDate())}`;\r\n}\r\n\r\nconst START_HOUR = 8;\r\nconst END_HOUR = 20;\r\n\r\ntype BookingMode = 'registered' | 'guest';\r\n\r\nconst AppointmentBooking: React.FC = () => {\r\n  // Data\r\n  const [doctors, setDoctors] = useState<DoctorRow[]>([]);\r\n  const [services, setServices] = useState<ServiceRow[]>([]);\r\n\r\n  // Filters at top\r\n  const [filterDate, setFilterDate] = useState(toDateInputValue(new Date()));\r\n  const [filterDoctorQuery, setFilterDoctorQuery] = useState('');\r\n  const [filterDoctor, setFilterDoctor] = useState<DoctorRow | null>(null);\r\n\r\n  // Booking doctor (same as filter selection)\r\n  const doctor = filterDoctor;\r\n\r\n  // Patient\r\n  const [mode, setMode] = useState<BookingMode>('registered');\r\n  const [patientSearch, setPatientSearch] = useState('');\r\n  const [patient, setPatient] = useState<PatientRow | null>(null);\r\n  const [patientMatches, setPatientMatches] = useState<PatientRow[]>([]);\r\n  const [patientModalOpen, setPatientModalOpen] = useState(false);\r\n\r\n  // Guest\r\n  const [guestName, setGuestName] = useState('');\r\n  const [guestContact, setGuestContact] = useState('');\r\n\r\n  // Booking date/time\r\n  const [date, setDate] = useState(toDateInputValue(new Date()));\r\n  const [timeValue, setTimeValue] = useState('');\r\n  const [notes, setNotes] = useState('');\r\n  const [message, setMessage] = useState<string | null>(null);\r\n\r\n  // Calendar\r\n  const [appointments, setAppointments] = useState([] as Awaited<ReturnType<typeof listAppointments>>);\r\n\r\n  // Add doctor availability state\r\n  const [doctorAvailability, setDoctorAvailability] = useState<DoctorAvailabilityRow[]>([]);\r\n\r\n  // Selected service (dropdown)\r\n  const [serviceQuery, setServiceQuery] = useState('');\r\n  const [selectedService, setSelectedService] = useState<ServiceRow | null>(null);\r\n\r\n  const refreshDoctors = async () => {\r\n    try {\r\n      const data = await listDoctors();\r\n      setDoctors(data);\r\n    } catch (e: any) {\r\n      console.error('Error refreshing doctors:', e);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      const [d, s] = await Promise.all([listDoctors(), listServices()]);\r\n      setDoctors(d); setServices(s);\r\n      setFilterDate(toDateInputValue(new Date()));\r\n    })();\r\n  }, []);\r\n\r\n  // filter doctors for dropdown\r\n  const filteredDoctors = useMemo(() => {\r\n    const q = filterDoctorQuery.trim().toLowerCase();\r\n    if (!q) return doctors;\r\n    return doctors.filter(d => d.name.toLowerCase().includes(q));\r\n  }, [filterDoctorQuery, doctors]);\r\n\r\n  // filter services for dropdown\r\n  const filteredServices = useMemo(() => {\r\n    const q = serviceQuery.trim().toLowerCase();\r\n    if (!q) return services;\r\n    return services.filter(s => s.service_name.toLowerCase().includes(q) || s.service_type.toLowerCase().includes(q));\r\n  }, [serviceQuery, services]);\r\n\r\n  const onSearchPatient = async () => {\r\n    setMessage(null);\r\n    const rows = await searchPatientsByContact(patientSearch);\r\n    if (rows.length === 1) { setPatient(rows[0]); setPatientMatches([]); }\r\n    else if (rows.length > 1) { setPatientMatches(rows); setPatientModalOpen(true); }\r\n    else { setPatient(null); setMessage('No patients found for that contact'); }\r\n  };\r\n\r\n  // Load appointments when doctor or date changes\r\n  useEffect(() => {\r\n    (async () => {\r\n      if (!doctor) { \r\n        setAppointments([]); \r\n        setDoctorAvailability([]);\r\n        return; \r\n      }\r\n      const list = await listAppointments({ doctor_id: doctor.id, appointment_date_exact: date });\r\n      setAppointments(list);\r\n      \r\n      // Load doctor availability\r\n      try {\r\n        const availability = await listDoctorAvailability(doctor.id);\r\n        setDoctorAvailability(availability);\r\n      } catch (err) {\r\n        console.error('Failed to load doctor availability:', err);\r\n        setDoctorAvailability([]);\r\n      }\r\n    })();\r\n  }, [doctor, date]);\r\n\r\n  // Slots for chosen booking date\r\n  const slots: { time: string; date: Date }[] = useMemo(() => {\r\n    const [y, m, d] = date.split('-').map(Number);\r\n    const base = new Date(y, (m - 1), d, START_HOUR, 0, 0, 0);\r\n    const arr: { time: string; date: Date }[] = [];\r\n    const end = new Date(y, (m - 1), d, END_HOUR, 0, 0, 0);\r\n    let cur = new Date(base);\r\n    while (cur <= end) { \r\n      arr.push({ time: formatTime(cur), date: new Date(cur) }); \r\n      cur = new Date(cur.getTime() + 15 * 60 * 1000); \r\n    }\r\n    return arr;\r\n  }, [date]);\r\n\r\n  // Check if a time slot is available based on doctor's availability settings\r\n  const isTimeSlotAvailable = (slotTime: string, slotDate: Date): boolean => {\r\n    // If no availability data, assume doctor is available from START_HOUR to END_HOUR (default behavior)\r\n    if (doctorAvailability.length === 0) {\r\n      const [slotHours, slotMinutes] = slotTime.split(':').map(Number);\r\n      const slotTimeInMinutes = slotHours * 60 + slotMinutes;\r\n      \r\n      // Default availability: START_HOUR to END_HOUR\r\n      const defaultStartTime = START_HOUR * 60;\r\n      const defaultEndTime = END_HOUR * 60;\r\n      \r\n      return slotTimeInMinutes >= defaultStartTime && slotTimeInMinutes < defaultEndTime;\r\n    }\r\n    \r\n    const slotDateString = slotDate.toISOString().split('T')[0]; // YYYY-MM-DD format\r\n    const dayOfWeek = slotDate.getDay(); // 0 = Sunday, 6 = Saturday\r\n    \r\n    // Check for specific date availability first (higher priority)\r\n    const specificDateEntries = doctorAvailability.filter(a => \r\n      a.specific_date === slotDateString\r\n    );\r\n    \r\n    // If we have specific date entries, check those first\r\n    if (specificDateEntries.length > 0) {\r\n      // Check if any specific entry marks the doctor as unavailable\r\n      const unavailableEntry = specificDateEntries.find(a => !a.is_available);\r\n      if (unavailableEntry) {\r\n        // Doctor is explicitly marked as unavailable for this specific date\r\n        return false;\r\n      }\r\n      \r\n      // Check if any specific entry marks the doctor as available and the time falls within range\r\n      const availableEntries = specificDateEntries.filter(a => a.is_available);\r\n      if (availableEntries.length > 0) {\r\n        return isTimeWithinAvailability(slotTime, availableEntries);\r\n      }\r\n      \r\n      // If only unavailable entries exist for this specific date, doctor is not available\r\n      return false;\r\n    }\r\n    \r\n    // Check for recurring availability\r\n    const recurringEntries = doctorAvailability.filter(a => \r\n      a.day_of_week === dayOfWeek && a.specific_date === null\r\n    );\r\n    \r\n    // If we have recurring entries, check those\r\n    if (recurringEntries.length > 0) {\r\n      // Check if any recurring entry marks the doctor as unavailable\r\n      const unavailableEntry = recurringEntries.find(a => !a.is_available);\r\n      if (unavailableEntry) {\r\n        // Doctor is explicitly marked as unavailable for this day of week\r\n        return false;\r\n      }\r\n      \r\n      // Check if any recurring entry marks the doctor as available and the time falls within range\r\n      const availableEntries = recurringEntries.filter(a => a.is_available);\r\n      if (availableEntries.length > 0) {\r\n        return isTimeWithinAvailability(slotTime, availableEntries);\r\n      }\r\n      \r\n      // If only unavailable entries exist for this day of week, doctor is not available\r\n      return false;\r\n    }\r\n    \r\n    // No availability found for this date/time\r\n    return false;\r\n  };\r\n  \r\n  // Helper function to check if a time is within availability ranges\r\n  const isTimeWithinAvailability = (slotTime: string, availabilityList: DoctorAvailabilityRow[]): boolean => {\r\n    const [slotHours, slotMinutes] = slotTime.split(':').map(Number);\r\n    const slotTimeInMinutes = slotHours * 60 + slotMinutes;\r\n    \r\n    for (const availability of availabilityList) {\r\n      const [startHours, startMinutes] = availability.start_time.split(':').map(Number);\r\n      const [endHours, endMinutes] = availability.end_time.split(':').map(Number);\r\n      \r\n      const startTimeInMinutes = startHours * 60 + startMinutes;\r\n      const endTimeInMinutes = endHours * 60 + endMinutes;\r\n      \r\n      // Check if slot time falls within this availability range\r\n      if (slotTimeInMinutes >= startTimeInMinutes && slotTimeInMinutes < endTimeInMinutes) {\r\n        return true;\r\n      }\r\n    }\r\n    \r\n    return false;\r\n  };\r\n\r\n  const bookedSlots = useMemo(() => {\r\n    if (!doctor) return new Set<string>();\r\n    const set = new Set<string>();\r\n    \r\n    // For each appointment, find which slot it belongs to\r\n    appointments.forEach(a => {\r\n      if (a.doctor_id !== doctor.id) return;\r\n      \r\n      // Use appointment_datetime if available, otherwise use appointment_date with time from created_at\r\n      let appointmentDate: Date;\r\n      if (a.appointment_datetime) {\r\n        // Use the full datetime if available\r\n        appointmentDate = new Date(a.appointment_datetime);\r\n      } else if (a.appointment_date) {\r\n        // Parse the appointment_date (YYYY-MM-DD format) and combine with time from created_at\r\n        const datePart = a.appointment_date; // Already in YYYY-MM-DD format\r\n        // Use the time from created_at\r\n        const timePart = new Date(a.created_at).toTimeString().split(' ')[0]; // Get HH:MM:SS\r\n        appointmentDate = new Date(`${datePart}T${timePart}`);\r\n      } else {\r\n        appointmentDate = new Date(a.created_at);\r\n      }\r\n      \r\n      // Validate that we have a valid date\r\n      if (isNaN(appointmentDate.getTime())) {\r\n        return;\r\n      }\r\n      \r\n      // Find the slot that this appointment belongs to by checking which 15-minute window it falls in\r\n      appointmentDate.setSeconds(0, 0);\r\n      const hours = appointmentDate.getHours();\r\n      const minutes = appointmentDate.getMinutes();\r\n      \r\n      // Validate that hours and minutes are valid numbers\r\n      if (isNaN(hours) || isNaN(minutes)) {\r\n        return;\r\n      }\r\n      \r\n      const appointmentMinutes = hours * 60 + minutes;\r\n      \r\n      // Round down to the nearest 15-minute slot\r\n      const slotMinutes = Math.floor(appointmentMinutes / 15) * 15;\r\n      const slotHours = Math.floor(slotMinutes / 60);\r\n      const slotMinute = slotMinutes % 60;\r\n      \r\n      // Format as HH:MM\r\n      const slotTime = `${slotHours.toString().padStart(2, '0')}:${slotMinute.toString().padStart(2, '0')}`;\r\n      set.add(slotTime);\r\n    });\r\n    \r\n    return set;\r\n  }, [appointments, doctor, date]);\r\n\r\n  const onPickSlot = (slotTime: string) => { setTimeValue(slotTime); };\r\n\r\n  const onSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault(); setMessage(null);\r\n    if (!doctor) { setMessage('Select doctor'); return; }\r\n    if (!date || !timeValue) { setMessage('Pick date and time'); return; }\r\n    if (mode === 'guest') { if (!guestName.trim() || !guestContact.trim()) { setMessage('Enter guest name and contact'); return; } }\r\n    else { if (!patient && !patientSearch.trim()) { setMessage('Enter contact and search patient'); return; } }\r\n    const [hh, mm] = timeValue.split(':').map(Number); const [y, m, d] = date.split('-').map(Number);\r\n    const dt = new Date(y, m - 1, d, hh, mm, 0, 0);\r\n    try {\r\n      await createAppointment({\r\n        patient_id: mode === 'guest' ? null : (patient?.id || null),\r\n        doctor_id: doctor.id,\r\n        appointment_date: date, // YYYY-MM-DD format\r\n        appointment_datetime: dt.toISOString(), // Full datetime\r\n        status: 'booked',\r\n      });\r\n      setMessage('Appointment booked'); setNotes('');\r\n      \r\n      // Refresh appointments to show the newly booked appointment\r\n      if (doctor) {\r\n        // Add a small delay to ensure the database has time to update\r\n        await new Promise(resolve => setTimeout(resolve, 500));\r\n        const list = await listAppointments({ doctor_id: doctor.id, appointment_date_exact: date });\r\n        setAppointments(list);\r\n      }\r\n    } catch (e: any) { setMessage(e.message); }\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      {/* Top filter bar */}\r\n      <div className=\"card p-4\">\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n          <div>\r\n            <label className=\"block text-sm font-medium\">Date</label>\r\n            <input type=\"date\" className=\"mt-1 w-full\" value={filterDate} onChange={e => { setFilterDate(e.target.value); setDate(e.target.value); }} />\r\n          </div>\r\n          <div>\r\n            <div className=\"flex items-center justify-between\">\r\n              <label className=\"block text-sm font-medium\">Doctor Name</label>\r\n              <button \r\n                type=\"button\" \r\n                className=\"text-xs text-brand-600 hover:text-brand-800\"\r\n                onClick={refreshDoctors}\r\n              >\r\n                Refresh List\r\n              </button>\r\n            </div>\r\n            <input className=\"mt-1 w-full\" placeholder=\"Search doctor\" value={filterDoctorQuery} onChange={e => { setFilterDoctorQuery(e.target.value); if (filterDoctor && e.target.value !== filterDoctor.name) setFilterDoctor(null); }} />\r\n            {filterDoctorQuery.trim() && !filterDoctor && (\r\n              <div className=\"mt-2 max-h-40 overflow-y-auto border border-gray-200 rounded-xl divide-y divide-gray-100\">\r\n                {filteredDoctors.map(d => (\r\n                  <div key={d.id} className={`px-3 py-2 cursor-pointer hover:bg-gray-50 ${doctor?.id === d.id ? 'bg-brand-50' : ''}`} onClick={() => { setFilterDoctor(d); setFilterDoctorQuery(d.name); }}>\r\n                    {d.name}\r\n                  </div>\r\n                ))}\r\n                {filteredDoctors.length === 0 && <div className=\"px-3 py-2 text-sm text-gray-500\">No match</div>}\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 items-start\">\r\n        {/* Left form panel */}\r\n        <div className=\"md:col-span-1 space-y-4\">\r\n          <div className=\"card p-5\">\r\n            <h2 className=\"text-lg font-semibold mb-3\">Booking Details</h2>\r\n            <div className=\"flex items-center gap-4\">\r\n              <label className=\"inline-flex items-center gap-2\">\r\n                <input type=\"radio\" checked={mode === 'registered'} onChange={() => setMode('registered')} />\r\n                Appointment\r\n              </label>\r\n              <label className=\"inline-flex items-center gap-2\">\r\n                <input type=\"radio\" checked={mode === 'guest'} onChange={() => setMode('guest')} />\r\n                New Registration\r\n              </label>\r\n            </div>\r\n\r\n            <div className=\"mt-4 space-y-3\">\r\n              <div>\r\n                <label className=\"block text-sm font-medium\">Name</label>\r\n                <input className=\"mt-1 w-full\" value={mode === 'guest' ? guestName : (patient?.name || '')} onChange={e => mode === 'guest' ? setGuestName(e.target.value) : setPatientSearch(e.target.value)} placeholder=\"Patient/Guest name\" readOnly={mode === 'registered' && !patient} />\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium\">Contact</label>\r\n                {mode === 'registered' ? (\r\n                  <div className=\"flex gap-2 mt-1\">\r\n                    <input className=\"flex-1\" placeholder=\"Enter contact number\" value={patientSearch} onChange={e => setPatientSearch(e.target.value)} />\r\n                    <button type=\"button\" className=\"btn btn-secondary\" onClick={onSearchPatient}>Search</button>\r\n                  </div>\r\n                ) : (\r\n                  <input className=\"mt-1 w-full\" value={guestContact} onChange={e => setGuestContact(e.target.value)} placeholder=\"Guest contact\" />\r\n                )}\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium\">Date</label>\r\n                <input type=\"date\" className=\"mt-1 w-full\" value={date} onChange={e => setDate(e.target.value)} />\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"mt-4\">\r\n              <label className=\"block text-sm font-medium\">Notes</label>\r\n              <input className=\"mt-1 w-full\" value={notes} onChange={e => setNotes(e.target.value)} placeholder=\"Optional\" />\r\n            </div>\r\n\r\n            <div className=\"mt-4 flex items-center gap-3\">\r\n              <button className=\"btn btn-primary\" onClick={onSubmit as any}>Book</button>\r\n            </div>\r\n            {message && <p className=\"text-sm mt-2\">{message}</p>}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Right calendar panel - scrollable box with same vertical alignment */}\r\n        <div className=\"md:col-span-2 flex flex-col gap-4\">\r\n          <div className=\"card p-5\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <div className=\"text-sm text-gray-500\">DATE</div>\r\n                <div className=\"text-xl font-semibold\">{new Date(date).toLocaleDateString('en-IN', { year: 'numeric', month: 'long', day: 'numeric' })}</div>\r\n              </div>\r\n              <div className=\"flex items-center gap-3\">\r\n                <span className=\"inline-flex items-center gap-1 text-sm\"><span className=\"w-3 h-3 inline-block rounded bg-green-200 border border-green-400\" /> Available</span>\r\n                <span className=\"inline-flex items-center gap-1 text-sm\"><span className=\"w-3 h-3 inline-block rounded bg-red-200 border border-red-400\" /> Booked</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div className=\"card p-5 max-h-[620px] overflow-y-auto\">\r\n            <div className=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3\">\r\n              {slots.map(({ time, date }) => {\r\n                // Calculate the end time for this slot (15 minutes later)\r\n                const [hours, minutes] = time.split(':').map(Number);\r\n                const slotDate = new Date(date);\r\n                slotDate.setHours(hours, minutes, 0, 0);\r\n                const endTime = new Date(slotDate.getTime() + 15 * 60000);\r\n                const endTimeString = formatTime(endTime);\r\n                \r\n                // Check if slot is available based on doctor's schedule\r\n                const isAvailable = isTimeSlotAvailable(time, date);\r\n                const isBooked = bookedSlots.has(time);\r\n                const isSelected = timeValue === time;\r\n                \r\n                // Check if slot is booked\r\n                if (isBooked) {\r\n                  console.log('Slot', time, 'is booked');\r\n                }\r\n                \r\n                // Slot is available only if it's within doctor's availability and not already booked\r\n                const slotAvailable = isAvailable && !isBooked;\r\n                \r\n                return (\r\n                  <button \r\n                    key={time} \r\n                    type=\"button\" \r\n                    onClick={() => slotAvailable && onPickSlot(time)} \r\n                    className={`p-3 rounded-lg border transition text-center ${\r\n                      !isAvailable ? 'bg-gray-100 border-gray-300 text-gray-500 cursor-not-allowed' :\r\n                      isBooked ? 'bg-red-100 border-red-300 text-red-800 cursor-not-allowed' :\r\n                      isSelected ? 'bg-blue-100 border-blue-300 text-blue-800' :\r\n                      'bg-green-100 border-green-300 text-green-800 hover:bg-green-200'\r\n                    }`}\r\n                    disabled={!slotAvailable}\r\n                  >\r\n                    <div className=\"font-medium\">{time} - {endTimeString}</div>\r\n                    <div className=\"text-xs mt-1\">\r\n                      {!isAvailable ? 'Not Available' :\r\n                       isBooked ? 'Booked' :\r\n                       isSelected ? 'Selected' :\r\n                       'Available'}\r\n                    </div>\r\n                  </button>\r\n                );\r\n              })}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <Modal open={patientModalOpen} title=\"Select Patient\" onClose={() => setPatientModalOpen(false)}>\r\n        <div className=\"divide-y divide-gray-100\">\r\n          {patientMatches.map(p => (\r\n            <div key={p.id} className=\"py-2\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                  <div className=\"font-medium\">{p.name} <span className=\"text-xs text-gray-500\">({p.age} / {p.gender})</span></div>\r\n                  <div className=\"text-xs text-gray-500\">{p.id} â€¢ {p.contact}</div>\r\n                </div>\r\n                <button className=\"btn btn-secondary\" onClick={() => { setPatient(p); setPatientModalOpen(false); setPatientMatches([]); }}>Select</button>\r\n              </div>\r\n            </div>\r\n          ))}\r\n          {patientMatches.length === 0 && <div className=\"py-4 text-sm text-gray-500\">No matches.</div>}\r\n        </div>\r\n      </Modal>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AppointmentBooking;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}